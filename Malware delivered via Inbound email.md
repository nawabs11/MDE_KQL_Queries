#let AbuseFeed = (externaldata(hash:string)
    [@"https://bazaar.abuse.ch/export/txt/sha256/recent/"]
    with (format = "txt"))
    | where hash !startswith '#'
    | project (hash);
    AbuseFeed
    | extend length= string_size(hash)
    | join ( EmailAttachmentInfo ) on $left.hash == $right.SHA256 
    | join EmailEvents on  NetworkMessageId | where DeliveryAction != "Blocked"
